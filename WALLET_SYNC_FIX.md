# 钱包状态同步修复指南

## 问题描述
您的个人中心页面显示钱包已连接，但控制台显示`asContractService: false`，这说明合约服务没有正确初始化。这是一个合约服务初始化问题。

## 解决方案

### 方法1: 使用页面内置修复功能（推荐）

1. **刷新页面** - 页面会自动检查并修复钱包状态
2. **点击"强制重连钱包"按钮** - 在个人中心页面的IPFS数据同步区域
3. **点击"调试任务加载"按钮** - 查看详细的状态信息

### 方法2: 手动断开重连

1. 断开钱包连接
2. 刷新页面
3. 重新连接钱包

### 方法3: 使用控制台脚本

在浏览器控制台中运行以下脚本：

```javascript
// 加载合约服务修复脚本
fetch('/fix-contract-service.js').then(r => r.text()).then(eval)

// 或者加载钱包同步修复脚本
fetch('/fix-wallet-sync.js').then(r => r.text()).then(eval)

// 或者直接运行修复函数
fixContractService()
```

### 方法4: 使用测试脚本

在浏览器控制台中运行：

```javascript
// 加载测试脚本
fetch('/test-wallet-sync.js').then(r => r.text()).then(eval)

// 重新执行测试
testWalletSync()
```

## 修复内容

修复脚本会自动：

1. ✅ 检查Aptos钱包连接状态
2. ✅ 检测状态不一致问题
3. ✅ 自动修复web3Store状态
4. ✅ 重新初始化Aptos合约服务
5. ✅ 确保合约服务可用
6. ✅ 更新账户余额
7. ✅ 重新加载用户数据

## 验证修复效果

修复成功后，您应该看到：

- ✅ 控制台显示"Aptos合约服务初始化成功"
- ✅ 个人中心页面显示正确的任务列表
- ✅ 钱包连接状态和实际状态一致
- ✅ `hasAptosContractService: true`
- ✅ 合约服务可用

## 常见问题

**Q: 修复后仍然看不到任务？**
A: 请检查是否已创建任务，或者尝试点击"调试任务加载"按钮

**Q: 钱包显示已连接但余额为0？**
A: 这是正常的，您的账户可能没有APT代币，需要充值测试网APT

**Q: 修复后页面无响应？**
A: 请刷新页面，或者断开钱包连接后重新连接

## 技术说明

这个问题是由于以下原因造成的：
- Vue应用和Pinia存储状态不同步
- 钱包连接状态检查时机问题
- Aptos合约服务初始化失败
- `web3Store.aptosContractService`未正确创建

修复脚本通过以下方式解决：
- 直接检查Aptos钱包API状态
- 手动同步web3Store状态
- 重新初始化Aptos合约服务
- 确保`aptosContractService`实例存在
- 强制刷新数据 