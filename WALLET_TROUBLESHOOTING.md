# 钱包连接和交易提交问题诊断指南

## 问题描述
创建任务失败，提示 "TaskFactory 初始化失败: Petra 钱包交易提交失败"

## 诊断步骤

### 1. 检查钱包安装和连接
1. 确认已安装 Petra 钱包扩展
2. 在浏览器中打开钱包，确认已连接到 Aptos 测试网
3. 确认钱包中有足够的 APT 余额（至少 0.1 APT）

### 2. 检查网络设置
- 确保 Petra 钱包网络设置为 "Testnet"
- 确认网络连接正常

### 3. 检查合约部署状态
- 确认合约已正确部署到测试网
- 检查合约地址是否正确

### 4. 浏览器控制台调试
1. 打开浏览器开发者工具 (F12)
2. 切换到 Console 标签页
3. 刷新页面，查看详细的错误信息
4. 特别注意以下错误类型：
   - 钱包连接错误
   - 网络错误
   - 合约调用错误
   - 余额不足错误

### 5. 使用测试页面
访问 `/test-aptos` 页面进行钱包连接和交易测试：
1. 点击 "连接钱包" 按钮
2. 查看连接状态和网络信息
3. 点击 "测试交易" 按钮
4. 查看详细的测试结果

## 常见错误和解决方案

### 错误 1: "未检测到可用的 Aptos 钱包"
**解决方案:**
- 安装 Petra 钱包扩展
- 确保钱包已启用
- 刷新页面重试

### 错误 2: "钱包连接失败"
**解决方案:**
- 检查钱包是否已解锁
- 确认钱包网络设置
- 尝试重新连接钱包

### 错误 3: "账户余额不足"
**解决方案:**
- 从测试网水龙头获取 APT
- 确保账户有足够的余额支付交易费用

### 错误 4: "网络连接问题"
**解决方案:**
- 检查网络连接
- 确认钱包网络设置正确
- 尝试切换网络后重试

### 错误 5: "合约函数调用错误"
**解决方案:**
- 确认合约已正确部署
- 检查合约地址和函数名
- 验证函数参数类型

## 调试信息收集

请在浏览器控制台中运行以下代码来收集调试信息：

```javascript
// 检查钱包状态
console.log('钱包状态检查:')
console.log('window.petra:', !!window.petra)
console.log('window.aptos:', !!window.aptos)

// 检查钱包连接
if (window.petra) {
  window.petra.account().then(account => {
    console.log('Petra 账户:', account)
  }).catch(err => {
    console.log('Petra 账户获取失败:', err)
  })
}

if (window.aptos) {
  window.aptos.account().then(account => {
    console.log('Aptos 账户:', account)
  }).catch(err => {
    console.log('Aptos 账户获取失败:', err)
  })
}
```

## 联系支持

如果问题仍然存在，请提供以下信息：
1. 浏览器类型和版本
2. Petra 钱包版本
3. 详细的错误信息
4. 浏览器控制台日志
5. 网络连接状态 